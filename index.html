<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Ouverture de Boîtes</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        button { margin: 5px; padding: 10px 20px; }
        .popup, .historique, .inventaire, .resultats { border: 1px solid #333; padding: 10px; margin-top: 20px; display: none; background: #f9f9f9; }
        textarea { width: 100%; height: 150px; }
    </style>
</head>
<body>

<h1>Ouverture de Boîtes</h1>

<button onclick="demanderNombreBoite('noire')">Ouvrir des Boîtes Noires I</button>
<button onclick="demanderNombreBoite('mystere')">Ouvrir des Boîtes Mystérieuses I</button>
<button onclick="afficherInventaire()">Voir et Ouvrir l'Inventaire</button>
<button onclick="afficherHistorique()">Voir l'Historique des Récompenses</button>

<div class="resultats" id="resultats"></div>
<div class="popup" id="popup"></div>
<div class="inventaire" id="inventaire"></div>
<div class="historique" id="historique"></div>

<script>
let inventaire = {
    "Boîte Noire II": 0, "Boîte Noire III": 0, "Boîte Noire IV": 0, "Boîte Noire V": 0,
    "Boîte Noire VI": 0, "Boîte Noire VII": 0, "Boîte Noire VIII": 0, "Boîte Noire IX": 0, "Boîte Noire X": 0,
    "Boîte Mystérieuse II": 0, "Boîte Mystérieuse III": 0, "Boîte Grand Mystère": 0
};

let historique = [];

function intToRoman(n) {
    let romans = ['I','II','III','IV','V','VI','VII','VIII','IX','X'];
    return romans[n-1] || n;
}

function romanToInt(roman) {
    let map = {'I':1,'II':2,'III':3,'IV':4,'V':5,'VI':6,'VII':7,'VIII':8,'IX':9,'X':10};
    return map[roman] || 1;
}

function ouvrirBoiteNoire(niveau) {
    let resultats = [];
    let orGagne = Math.floor(Math.random() * (niveau * 100)) + 1;
    let contenu = `${orGagne} pièces d'or`;

    if (niveau >= 9 && Math.random() < 0.01) contenu += " / Arrière-plan de profil";
    if (niveau < 10 && Math.random() < 0.2) {
        let prochaineBoite = "Boîte Noire " + intToRoman(niveau + 1);
        contenu += ` / ${prochaineBoite}`;
        inventaire[prochaineBoite] = (inventaire[prochaineBoite] || 0) + 1;
    }

    resultats.push(contenu);
    return resultats;
}

function ouvrirBoiteMysterieuse(niveau) {
    let resultats = [];
    let chance = Math.random();
    let contenu = "";

    if (niveau === 1) {
        if (chance < 0.05) contenu = "Certificat mystère";
        else if (chance < 0.10) contenu = `${rand(100,200)} pièces`;
        else if (chance < 0.1001) contenu = "100000 pièces";
        else contenu = `${rand(10,50)} pièces`;
        if (Math.random() < (1/15)) inventaire["Boîte Mystérieuse II"]++;
    } else if (niveau === 2) {
        if (chance < 0.10) contenu = "Certificat mystère";
        else if (chance < 0.20) contenu = `${rand(100,500)} pièces`;
        else if (chance < 0.2001) contenu = "200000 pièces";
        else if (chance < 0.21) contenu = "Avatar spécial";
        else contenu = `${rand(50,150)} pièces`;
        if (Math.random() < (1/10)) inventaire["Boîte Mystérieuse III"]++;
    } else if (niveau === 3) {
        if (chance < 0.15) contenu = "Certificat mystère";
        else if (chance < 0.25) contenu = `${rand(100,1000)} pièces`;
        else if (chance < 0.2501) contenu = "250000 pièces";
        else if (chance < 0.30) contenu = "Avatar spécial";
        else if (chance < 0.31) contenu = "Arrière-plan de profil";
        else contenu = `${rand(100,300)} pièces`;
        if (Math.random() < (1/10)) inventaire["Boîte Grand Mystère"]++;
    } else if (niveau === 4) {
        contenu = "Certificat grand mystère + char spécial + camouflage spécial + 1000-10000 pièces";
        if (Math.random() < 0.1) contenu += " + Avatar spécial";
        if (Math.random() < 0.05) contenu += " + Arrière-plan de profil";
    }

    resultats.push(contenu);
    return resultats;
}

function rand(min, max) {
    return Math.floor(Math.random() * (max - min +1)) + min;
}

function demanderNombreBoite(type) {
    let html = `<p>Nombre de boîtes :</p>
        <input type="number" id="nbBoites" min="1" value="1">
        <br><button onclick="validerNbBoites('${type}')">Valider</button>`;
    afficherPopup(html);
}

function validerNbBoites(type) {
    let nb = parseInt(document.getElementById("nbBoites").value);
    fermerPopup();
    if (nb > 0) {
        if (type === "noire") ouvrirBoitesNoires(nb);
        else ouvrirBoitesMysteres(nb);
    }
}

function ouvrirBoitesNoires(nb) {
    let total = [];
    for (let i = 0; i < nb; i++) {
        let res = ouvrirBoiteNoire(1);
        let texte = `Reçu de la Boîte Noire I :\n- ` + res.join("\n- ");
        total.push(texte);
        historique.push(texte);
    }
    afficherResultats(total);
}

function ouvrirBoitesMysteres(nb) {
    let total = [];
    for (let i = 0; i < nb; i++) {
        let res = ouvrirBoiteMysterieuse(1);
        let texte = `Reçu de la Boîte Mystérieuse I :\n- ` + res.join("\n- ");
        total.push(texte);
        historique.push(texte);
    }
    afficherResultats(total);
}

function afficherInventaire() {
    let contenu = "";
    for (let boite in inventaire) {
        if (inventaire[boite] > 0) {
            contenu += `${boite} : ${inventaire[boite]} <button onclick="ouvrirDepuisInventaire('${boite}')">Ouvrir</button><br>`;
        }
    }
    if (!contenu) contenu = "Inventaire vide.";
    document.getElementById("inventaire").innerHTML = `<h3>Inventaire</h3>${contenu}`;
    cacherTout();
    document.getElementById("inventaire").style.display = "block";
}

function ouvrirDepuisInventaire(boiteNom) {
    inventaire[boiteNom]--;
    let total = [];
    let texte = "";

    if (boiteNom.includes("Noire")) {
        let niveau = romanToInt(boiteNom.split(" ").pop());
        let res = ouvrirBoiteNoire(niveau);
        texte = `Reçu de la ${boiteNom} :\n- ` + res.join("\n- ");
    } else {
        let niveau = 1;
        if (boiteNom.includes("Grand")) niveau = 4;
        else niveau = romanToInt(boiteNom.split(" ").pop());
        let res = ouvrirBoiteMysterieuse(niveau);
        texte = `Reçu de la ${boiteNom} :\n- ` + res.join("\n- ");
    }

    total.push(texte);
    historique.push(texte);
    afficherResultats(total);
}

function afficherHistorique() {
    let contenu = historique.length ? historique.join("\n\n---\n\n") : "Aucune récompense obtenue pour l'instant.";
    document.getElementById("historique").innerHTML = `<h3>Historique</h3><textarea readonly>${contenu}</textarea>`;
    cacherTout();
    document.getElementById("historique").style.display = "block";
}

function afficherResultats(resultats) {
    let html = `<h3>Récompenses obtenues</h3><textarea readonly>${resultats.join("\n\n")}</textarea><br>
    <button onclick="fermerResultats()">Fermer</button>
    <button onclick="afficherHistorique()">Voir l'historique</button>`;
    document.getElementById("resultats").innerHTML = html;
    cacherTout();
    document.getElementById("resultats").style.display = "block";
}

function fermerResultats() {
    document.getElementById("resultats").style.display = "none";
}

function afficherPopup(html) {
    document.getElementById("popup").innerHTML = html + `<br><button onclick="fermerPopup()">Annuler</button>`;
    document.getElementById("popup").style.display = "block";
}

function fermerPopup() {
    document.getElementById("popup").style.display = "none";
}

function cacherTout() {
    document.getElementById("resultats").style.display = "none";
    document.getElementById("popup").style.display = "none";
    document.getElementById("inventaire").style.display = "none";
    document.getElementById("historique").style.display = "none";
}
</script>

</body>
</html>
